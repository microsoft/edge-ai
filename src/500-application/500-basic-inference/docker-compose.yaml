---
services:
  inference-pipeline:
    image: ${REGISTRY:-local}/${APPLICATION:-basic-inference}/inference-pipeline:${BUILD_ID:-latest}
    build:
      context: ./services/pipeline
    environment:
      INFERENCE_URL: "http://inference-service:8883"
      AIO_MQTT_USE_TLS: "false"
      AIO_MQTT_CLIENT_ID: "InferencePipeline"
      AIO_BROKER_HOSTNAME: "mosquitto-broker"
      AIO_BROKER_TCP_PORT: "1883"
    depends_on:
      - mosquitto-broker
    networks:
      - basic-inference


  mosquitto-broker:
    image: eclipse-mosquitto@sha256:7b77b81b6d25b1fc6cc5ed1eb8ae48c247d4fd6f9aef1f7ee88b4a8e0b7f2b3e@sha256:7b77b81b6d25b1fc6cc5ed1eb8ae48c247d4fd6f9aef1f7ee88b4a8e0b7f2b3e
    ports:
      - "1883:1883"
      - "9001:9001"
    volumes:
      - "./resources/mosquitto.conf:/mosquitto/config/mosquitto.conf"
    networks:
      - basic-inference

networks:
  basic-inference: null
