<!-- BEGIN_TF_DOCS -->
# Microsoft Foundry

Creates Microsoft Foundry infrastructure with accounts, projects, and model deployments
for AI development and deployment scenarios. Uses AzAPI provider for full API support.

## Requirements

| Name      | Version         |
|-----------|-----------------|
| terraform | >= 1.9.8, < 2.0 |
| azapi     | >= 2.3.0        |
| azurerm   | >= 4.51.0       |

## Providers

| Name    | Version   |
|---------|-----------|
| azapi   | >= 2.3.0  |
| azurerm | >= 4.51.0 |

## Resources

| Name                                                                                                                                    | Type     |
|-----------------------------------------------------------------------------------------------------------------------------------------|----------|
| [azapi_resource.ai_foundry](https://registry.terraform.io/providers/Azure/azapi/latest/docs/resources/resource)                         | resource |
| [azapi_resource.deployment](https://registry.terraform.io/providers/Azure/azapi/latest/docs/resources/resource)                         | resource |
| [azapi_resource.project](https://registry.terraform.io/providers/Azure/azapi/latest/docs/resources/resource)                            | resource |
| [azapi_resource.rai_policy](https://registry.terraform.io/providers/Azure/azapi/latest/docs/resources/resource)                         | resource |
| [azurerm_private_endpoint.ai_foundry](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |

## Inputs

| Name                                    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Type                                                                                                                                                                                                                                                                                                                             | Default | Required |
|-----------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|:--------:|
| environment                             | Environment for all resources in this module: dev, test, or prod                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                         | n/a     |   yes    |
| location                                | Location for all resources in this module                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `string`                                                                                                                                                                                                                                                                                                                         | n/a     |   yes    |
| resource\_group                         | Resource group object from 000-resource-group component                                                                                                                                                                                                                                                                                                                                                                                                                                                               | ```object({ name = string id = optional(string) location = optional(string) })```                                                                                                                                                                                                                                                | n/a     |   yes    |
| resource\_prefix                        | Prefix for all resources in this module                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                         | n/a     |   yes    |
| ai\_foundry\_name                       | Name for the Microsoft Foundry account. If not provided, defaults to 'aif-{resource\_prefix}-{environment}-{instance}'                                                                                                                                                                                                                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                                                                                                         | `null`  |    no    |
| ai\_projects                            | Map of Microsoft Foundry projects to create. SKU defaults to 'S0' (currently the only supported value)                                                                                                                                                                                                                                                                                                                                                                                                                | ```map(object({ name = string display_name = string description = string sku = optional(string, "S0") }))```                                                                                                                                                                                                                     | `{}`    |    no    |
| cmk\_identity\_client\_id               | Client ID of the User Assigned Managed Identity for accessing the Key Vault key. Required when using CMK encryption with User Assigned Identity                                                                                                                                                                                                                                                                                                                                                                       | `string`                                                                                                                                                                                                                                                                                                                         | `null`  |    no    |
| instance                                | Instance identifier for naming resources: 001, 002, etc                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                         | `"001"` |    no    |
| key\_vault                              | Key Vault object for customer-managed key encryption. Required when should\_enable\_cmk\_encryption is true                                                                                                                                                                                                                                                                                                                                                                                                           | ```object({ id = optional(string) name = optional(string) vault_uri = optional(string) tenant_id = optional(string) key_name = optional(string) key_version = optional(string) })```                                                                                                                                             | `null`  |    no    |
| model\_deployments                      | Map of model deployments to create on the Microsoft Foundry account.  Example: ```hcl model_deployments = { gpt4o = { name = "gpt-4o" model = { format = "OpenAI" name = "gpt-4o" version = "2024-11-20" } scale = { type = "GlobalStandard" capacity = 10 } } }```                                                                                                                                                                                                                                                   | ```map(object({ name = string model = object({ format = string name = string version = string }) scale = object({ type = string capacity = number }) rai_policy_name = optional(string) version_upgrade_option = optional(string, "OnceNewDefaultVersionAvailable") }))```                                                       | `{}`    |    no    |
| private\_dns\_zone\_ids                 | List of private DNS zone IDs for the Microsoft Foundry private endpoint. Required zones for full functionality: - privatelink.cognitiveservices.azure.com - privatelink.openai.azure.com - privatelink.services.ai.azure.com                                                                                                                                                                                                                                                                                          | `list(string)`                                                                                                                                                                                                                                                                                                                   | `[]`    |    no    |
| private\_endpoint\_subnet\_id           | The ID of the subnet for the private endpoint. Required when should\_enable\_private\_endpoint is true                                                                                                                                                                                                                                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                                                                                                         | `null`  |    no    |
| rai\_policies                           | Map of Responsible AI (RAI) content filtering policies to create. These policies must be created before they can be referenced in model deployments.  Example: ```hcl rai_policies = { default_v2 = { name = "DefaultV2" base_policy_name = "Microsoft.Default" mode = "Blocking" content_filters = [ { name = "Hate" enabled = true blocking = true severity_threshold = "Medium" source = "Prompt" }, { name = "Hate" enabled = true blocking = true severity_threshold = "Medium" source = "Completion" } ] } }``` | ```map(object({ name = string base_policy_name = optional(string, "Microsoft.Default") mode = optional(string, "Blocking") content_filters = optional(list(object({ name = string enabled = optional(bool, true) blocking = optional(bool, true) severity_threshold = optional(string, "Medium") source = string })), []) }))``` | `{}`    |    no    |
| should\_enable\_cmk\_encryption         | Whether to enable customer-managed key encryption using Key Vault. Requires key\_vault variable                                                                                                                                                                                                                                                                                                                                                                                                                       | `bool`                                                                                                                                                                                                                                                                                                                           | `false` |    no    |
| should\_enable\_local\_auth             | Whether to enable local (API key) authentication. Set to false for Entra ID only                                                                                                                                                                                                                                                                                                                                                                                                                                      | `bool`                                                                                                                                                                                                                                                                                                                           | `true`  |    no    |
| should\_enable\_private\_endpoint       | Whether to create a private endpoint for the Microsoft Foundry account                                                                                                                                                                                                                                                                                                                                                                                                                                                | `bool`                                                                                                                                                                                                                                                                                                                           | `false` |    no    |
| should\_enable\_public\_network\_access | Whether to enable public network access to the Microsoft Foundry account                                                                                                                                                                                                                                                                                                                                                                                                                                              | `bool`                                                                                                                                                                                                                                                                                                                           | `true`  |    no    |
| sku                                     | SKU name for the Microsoft Foundry account (S0 is required for AI Services)                                                                                                                                                                                                                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                         | `"S0"`  |    no    |
| tags                                    | Tags to apply to all resources in this module                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `map(string)`                                                                                                                                                                                                                                                                                                                    | `{}`    |    no    |

## Outputs

| Name                       | Description                                                                           |
|----------------------------|---------------------------------------------------------------------------------------|
| ai\_foundry                | The Microsoft Foundry account resource.                                               |
| ai\_foundry\_endpoint      | The endpoint URL of the Microsoft Foundry account.                                    |
| ai\_foundry\_id            | The resource ID of the Microsoft Foundry account.                                     |
| ai\_foundry\_name          | The name of the Microsoft Foundry account.                                            |
| ai\_foundry\_principal\_id | The principal ID of the Microsoft Foundry account's system-assigned managed identity. |
| deployments                | Map of model deployment resources.                                                    |
| private\_endpoint          | The private endpoint resource (if created).                                           |
| projects                   | Map of Microsoft Foundry project resources.                                           |
| rai\_policies              | Map of RAI policy resources.                                                          |
<!-- END_TF_DOCS -->
