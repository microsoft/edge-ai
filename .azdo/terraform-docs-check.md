# Terraform Documentation Check Process

This document explains how Terraform module documentation is automatically validated in the CI/CD pipeline.

## Overview

The project maintains consistent and up-to-date documentation for all Terraform modules by using
[terraform-docs](https://terraform-docs.io/). A CI/CD check ensures that all Terraform documentation has been properly
generated by the contributor before code can be merged. It is incumbent on project contributors to keep the documentation up to date,
but the CI/CD pipeline will check for inconsistencies.

## Process Flow

1. The CI/CD pipeline runs the `TerraformDocsCheck` job
2. The job executes the `tf-docs-check.sh` script
3. The script verifies that required tools are installed
4. The script runs `update-all-terraform-docs.sh` to generate documentation
5. If any README.md files were changed, the check fails indicating documentation needs to be updated

## Scripts

### tf-docs-check.sh

Located at `./scripts/tf-docs-check.sh`, this script:

- Verifies that `terraform-docs` and `jq` are installed
- Runs the `update-all-terraform-docs.sh` script
- Checks if any README.md files were modified after running the documentation generator
- Returns a boolean indicating if changes were detected
- Used primarily by the CI/CD pipeline to validate documentation

### update-all-terraform-docs.sh

Located at `./scripts/update-all-terraform-docs.sh`, this script:

- Discovers all folders containing Terraform files (*.tf)
- Excludes test directories and other non-relevant folders
- For each valid folder, generates documentation using a standard configuration file
- Inserts documentation into README.md files

## Configuration

The scripts use a `.terraform-docs.yml` configuration file located at the repository root. This file defines:

- The output format for documentation
- Section ordering
- Content to include/exclude
- Other terraform-docs specific settings

## CI/CD Integration

The Azure Pipeline includes a job called `TerraformDocsCheck` that:

1. Runs on appropriate build triggers
2. Executes the tf-docs-check.sh script
3. Fails the build if documentation updates are required

## Developer Workflow

As a developer:

1. After making changes to Terraform files, run `./scripts/update-all-terraform-docs.sh`
2. Commit any updated README.md files along with your code changes
3. This ensures the CI/CD check will pass when you create a PR

## Prerequisites

Ensure these tools are installed:

- [terraform-docs](https://terraform-docs.io/user-guide/installation/)
- [jq](https://stedolan.github.io/jq/download/)

## Troubleshooting

If the CI/CD check fails:

1. Run `./scripts/update-all-terraform-docs.sh` locally
2. Commit any changes to README.md files
3. Push the changes to your branch

## Additional Resources

- [terraform-docs User Guide](https://terraform-docs.io/user-guide/)
- [terraform-docs Configuration](https://terraform-docs.io/user-guide/configuration/)
